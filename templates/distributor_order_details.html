{% extends "base.html" %}

{% block title %}Order Details - Order #{{ order.order_id }}{% endblock %}

{% block content %}

<div style="margin-bottom: 20px;">
    <a href="/distributor_orders" style="color: #3498db; text-decoration: none;">â† Back to Orders</a>
</div>

<h1>ğŸ›’ Order Details - Order #{{ order.order_id }}</h1>
<p style="color: #7f8c8d; margin-bottom: 30px;">Complete order information and tracking details</p>

<!-- Order Status Overview -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
        <p style="color: #7f8c8d; font-size: 0.9em; text-transform: uppercase; margin-bottom: 10px;">Order Status</p>
        <p style="font-size: 1.5em; font-weight: bold;">
            <span class="status {{ order.order_status }}">{{ order.order_status }}</span>
        </p>
    </div>

    <div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
        <p style="color: #7f8c8d; font-size: 0.9em; text-transform: uppercase; margin-bottom: 10px;">Payment Status</p>
        <p style="font-size: 1.5em; font-weight: bold;">
            <span class="status {{ order.payment_status }}">{{ order.payment_status }}</span>
        </p>
    </div>

    <div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
        <p style="color: #7f8c8d; font-size: 0.9em; text-transform: uppercase; margin-bottom: 10px;">Order Date</p>
        <p style="font-size: 1.2em; font-weight: bold;">{{ order.order_date }}</p>
    </div>

    <div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
        <p style="color: #7f8c8d; font-size: 0.9em; text-transform: uppercase; margin-bottom: 10px;">Order Total</p>
        <p style="font-size: 1.5em; font-weight: bold; color: #27ae60;">â‚¹{{ "%.2f"|format(order.total_amount) }}</p>
    </div>
</div>

<!-- Two Column Layout -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">

    <!-- Customer Information -->
    <div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
        <h3 style="margin-bottom: 15px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">ğŸ‘¤ Customer Information</h3>
        <p><strong>Name:</strong> {{ order.customer_name }}</p>
        <p><strong>Email:</strong> {{ order.customer_email }}</p>
        <p><strong>Phone:</strong> {{ order.customer_phone }}</p>
        <p><strong>City:</strong> {{ order.customer_city }}, {{ order.customer_state }}</p>
    </div>

    <!-- Shipping Information -->
    <div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
        <h3 style="margin-bottom: 15px; border-bottom: 2px solid #27ae60; padding-bottom: 10px;">ğŸšš Shipping Information</h3>
        <p><strong>Shipping Address:</strong></p>
        <p style="margin-left: 20px;">{{ order.shipping_address }}</p>
        
        {% if order.shipment %}
        <p style="margin-top: 15px;"><strong>Tracking Number:</strong> {{ order.shipment.tracking_number }}</p>
        <p><strong>Carrier:</strong> {{ order.shipment.carrier }}</p>
        <p><strong>Estimated Delivery:</strong> {{ order.shipment.estimated_delivery_date }}</p>
        {% else %}
        <p style="color: #e74c3c;"><strong>Status:</strong> Not yet shipped</p>
        {% endif %}
    </div>
</div>

<!-- Order Items -->
<div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
    <h3 style="margin-bottom: 15px;">ğŸ“¦ Order Items</h3>
    
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
            <tr>
                <td>
                    <strong>{{ item.product_name }}</strong>
                    <br>
                    <small style="color: #7f8c8d;">Category: {{ item.category }}</small>
                </td>
                <td style="text-align: center;">{{ item.quantity }} units</td>
                <td style="text-align: right;">â‚¹{{ "%.2f"|format(item.unit_price) }}</td>
                <td style="text-align: right;">â‚¹{{ "%.2f"|format(item.subtotal) }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot style="background-color: #f5f5f5; font-weight: bold;">
            <tr>
                <td colspan="3" style="text-align: right; padding: 12px 15px;">Total Amount:</td>
                <td style="text-align: right; padding: 12px 15px;">â‚¹{{ "%.2f"|format(order.total_amount) }}</td>
            </tr>
        </tfoot>
    </table>
</div>

<!-- Payment Information -->
<div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
    <h3 style="margin-bottom: 15px;">ğŸ’³ Payment Information</h3>
    
    {% if order.payment %}
    <table>
        <tr>
            <td><strong>Payment Method:</strong></td>
            <td>{{ order.payment.payment_method }}</td>
        </tr>
        <tr>
            <td><strong>Amount Paid:</strong></td>
            <td>â‚¹{{ "%.2f"|format(order.payment.amount) }}</td>
        </tr>
        <tr>
            <td><strong>Transaction ID:</strong></td>
            <td>{{ order.payment.transaction_id }}</td>
        </tr>
        <tr>
            <td><strong>Payment Date:</strong></td>
            <td>{{ order.payment.payment_date }}</td>
        </tr>
        <tr>
            <td><strong>Payment Status:</strong></td>
            <td><span class="status {{ order.payment.payment_status }}">{{ order.payment.payment_status }}</span></td>
        </tr>
    </table>
    {% else %}
    <p style="color: #e74c3c;">No payment information available</p>
    {% endif %}
</div>

<!-- Order Timeline / History -->
<div style="background-color: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">ğŸ“‹ Order Timeline</h3>
    
    <div style="border-left: 3px solid #3498db; padding-left: 20px;">
        <div style="margin-bottom: 20px;">
            <p style="font-weight: bold; color: #3498db;">Order Created</p>
            <p style="color: #7f8c8d; font-size: 0.9em;">{{ order.order_date }}</p>
        </div>

        {% if order.payment_date %}
        <div style="margin-bottom: 20px;">
            <p style="font-weight: bold; color: #27ae60;">âœ“ Payment Received</p>
            <p style="color: #7f8c8d; font-size: 0.9em;">{{ order.payment_date }}</p>
        </div>
        {% endif %}

        {% if order.shipment %}
        <div style="margin-bottom: 20px;">
            <p style="font-weight: bold; color: #f39c12;">ğŸ“¦ Shipment Dispatched</p>
            <p style="color: #7f8c8d; font-size: 0.9em;">{{ order.shipment.shipment_date }}</p>
            <p style="margin-top: 5px;">Tracking: {{ order.shipment.tracking_number }}</p>
        </div>

        {% if order.shipment.actual_delivery_date %}
        <div>
            <p style="font-weight: bold; color: #27ae60;">âœ“ Delivered</p>
            <p style="color: #7f8c8d; font-size: 0.9em;">{{ order.shipment.actual_delivery_date }}</p>
        </div>
        {% endif %}
        {% endif %}
    </div>
</div>

<!-- Action Buttons -->
<div style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;">
    {% if order.order_status == 'processing' %}
        <a href="/distributor/ship_order/{{ order.order_id }}" class="btn btn-success">ğŸ“¦ Mark as Shipped</a>
    {% endif %}
    
    {% if order.order_status == 'shipped' %}
        <a href="/distributor/mark_delivered/{{ order.order_id }}" class="btn btn-info">âœ“ Mark as Delivered</a>
    {% endif %}
    
    <a href="/distributor/print_order/{{ order.order_id }}" class="btn btn-warning">ğŸ–¨ï¸ Print Order</a>
    <a href="/distributor/export_order/{{ order.order_id }}" class="btn btn-primary">ğŸ“¥ Export Details</a>
    <a href="/distributor_orders" class="btn btn-info">Back to Orders</a>
</div>

{% endblock %}